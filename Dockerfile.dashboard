FROM node:20-alpine

WORKDIR /app

# نسخ ملفات التبعيات
COPY dashboard-arc/package*.json ./
COPY dashboard-arc/shared ./shared

# تثبيت المكتبات
RUN npm ci --legacy-peer-deps

# نسخ باقي الكود
COPY dashboard-arc/ .

# بناء التطبيق (Frontend + Backend)
# ملاحظة: نستخدم المتغيرات لبناء الـ Frontend
ENV VITE_API_URL=/api
RUN npm run build

# إعداد التشغيل
ENV PORT=5001
ENV NODE_ENV=production
EXPOSE 5001

CMD ["npm", "start"]
