/**\n * Media Script Agent\n * Generates video scripts, audio scripts, and multimedia content\n */\n\nimport { generateContent, streamGenerate, analyzeImage } from '@/api/geminiClient'\n\n/**\n * Generate video script\n */\nexport async function generateVideoScript(manuscript, duration = 60, onProgress) {\n  try {\n    const prompt = `أنشئ سيناريو فيديو بمدة ${duration} ثانية:\n\nالكتاب:\nالعنوان: ${manuscript.title}\nالمؤلف: ${manuscript.author}\nالملخص: ${manuscript.description || manuscript.content?.substring(0, 500) || ''}\n\nالمتطلبات:\n- مدة الفيديو: ${duration} ثانية\n- نص جذاب وملهم\n- وصف المشاهد والحركات\n- توقيت دقيق لكل جزء\n- تأثيرات صوتية وموسيقى\n- نصائح للتصوير\n\nصيغة الإجابة:\n[الوقت] | [النص] | [المشهد] | [الصوت]\n\nمثال:\n0-5s | \"اكتشف عالماً جديداً...\" | لقطة عريضة للكتاب | موسيقى درامية`\n\n    let fullContent = ''\n    await streamGenerate(prompt, (chunk) => {\n      fullContent += chunk\n      if (onProgress) onProgress(fullContent)\n    })\n\n    return {\n      success: true,\n      script: parseVideoScript(fullContent),\n      raw: fullContent,\n      duration\n    }\n  } catch (error) {\n    console.error('Video script generation error:', error)\n    throw new Error(`فشل توليد سيناريو الفيديو: ${error.message}`)\n  }\n}\n\n/**\n * Parse video script\n */\nfunction parseVideoScript(text) {\n  const scenes = []\n  const lines = text.split('\\n').filter(line => line.trim())\n\n  lines.forEach(line => {\n    const parts = line.split('|').map(p => p.trim())\n    if (parts.length >= 4) {\n      scenes.push({\n        timing: parts[0],\n        narration: parts[1],\n        scene: parts[2],\n        audio: parts[3]\n      })\n    }\n  })\n\n  return scenes\n}\n\n/**\n * Generate podcast script\n */\nexport async function generatePodcastScript(manuscript, duration = 30, onProgress) {\n  try {\n    const prompt = `أنشئ سيناريو بودكاست بمدة ${duration} دقيقة:\n\nالكتاب:\nالعنوان: ${manuscript.title}\nالمؤلف: ${manuscript.author}\nالملخص: ${manuscript.description || manuscript.content?.substring(0, 500) || ''}\n\nالمتطلبات:\n- مدة البودكاست: ${duration} دقيقة\n- مقدمة جذابة (2 دقيقة)\n- عرض المحتوى الرئيسي (${duration - 4} دقائق)\n- خاتمة وتحفيز (2 دقيقة)\n- نقاط نقاش\n- أسئلة للمستمعين\n- موارد إضافية\n\nصيغة الإجابة:\n[الوقت] | [النص] | [الملاحظات]\n\nاجعل النص طبيعياً وسهل النطق.`\n\n    let fullContent = ''\n    await streamGenerate(prompt, (chunk) => {\n      fullContent += chunk\n      if (onProgress) onProgress(fullContent)\n    })\n\n    return {\n      success: true,\n      script: parsePodcastScript(fullContent),\n      raw: fullContent,\n      duration\n    }\n  } catch (error) {\n    console.error('Podcast script generation error:', error)\n    throw new Error(`فشل توليد سيناريو البودكاست: ${error.message}`)\n  }\n}\n\n/**\n * Parse podcast script\n */\nfunction parsePodcastScript(text) {\n  const segments = []\n  const lines = text.split('\\n').filter(line => line.trim())\n\n  lines.forEach(line => {\n    const parts = line.split('|').map(p => p.trim())\n    if (parts.length >= 3) {\n      segments.push({\n        timing: parts[0],\n        narration: parts[1],\n        notes: parts[2]\n      })\n    }\n  })\n\n  return segments\n}\n\n/**\n * Generate audiobook narration guide\n */\nexport async function generateAudiobookGuide(manuscript) {\n  try {\n    const prompt = `أنشئ دليل نطق لكتاب صوتي:\n\nالكتاب:\nالعنوان: ${manuscript.title}\nالمؤلف: ${manuscript.author}\n\nالدليل يجب أن يتضمن:\n1. نصائح النطق العامة\n2. قائمة الأسماء والكلمات الصعبة مع النطق الصحيح\n3. نصائح للتعبير الصوتي\n4. إرشادات للتنفس والوقفات\n5. نصائح لتجنب الأخطاء الشائعة\n6. معدل النطق الموصى به\n7. مستويات الصوت والتأثيرات\n\nصيغة الإجابة:\nالكلمة | النطق الصحيح | الشرح`\n\n    const guide = await generateContent(prompt)\n    return parseAudiobookGuide(guide)\n  } catch (error) {\n    console.error('Audiobook guide generation error:', error)\n    throw error\n  }\n}\n\n/**\n * Parse audiobook guide\n */\nfunction parseAudiobookGuide(text) {\n  const sections = text.split(/\\n\\d\\.\\s+/)\n  const guide = {\n    generalTips: sections[1]?.split('\\n')[0] || '',\n    pronunciations: [],\n    expressionTips: sections[3]?.split('\\n')[0] || '',\n    breathingTips: sections[4]?.split('\\n')[0] || '',\n    commonMistakes: sections[5]?.split('\\n')[0] || '',\n    speechRate: sections[6]?.split('\\n')[0] || '',\n    soundLevels: sections[7]?.split('\\n')[0] || ''\n  }\n\n  // Extract pronunciations\n  const pronunciationSection = sections[2] || ''\n  const lines = pronunciationSection.split('\\n').filter(line => line.trim())\n  lines.forEach(line => {\n    const parts = line.split('|').map(p => p.trim())\n    if (parts.length >= 3) {\n      guide.pronunciations.push({\n        word: parts[0],\n        pronunciation: parts[1],\n        explanation: parts[2]\n      })\n    }\n  })\n\n  return guide\n}\n\n/**\n * Generate social media video scripts\n */\nexport async function generateSocialVideoScripts(manuscript) {\n  try {\n    const platforms = {\n      tiktok: 15,\n      instagram: 30,\n      youtube: 60\n    }\n\n    const scripts = {}\n\n    for (const [platform, duration] of Object.entries(platforms)) {\n      const prompt = `أنشئ سيناريو فيديو قصير لـ ${platform} بمدة ${duration} ثانية:\n\nالكتاب: ${manuscript.title}\nالملخص: ${manuscript.description || ''}\n\nالمتطلبات:\n- مثير للاهتمام من البداية\n- نص قصير وجذاب\n- مناسب لـ ${platform}\n- يشجع على المشاركة والتعليقات\n- يتضمن call-to-action\n\nأعد السيناريو فقط بدون شرح.`\n\n      scripts[platform] = await generateContent(prompt)\n    }\n\n    return scripts\n  } catch (error) {\n    console.error('Social video scripts error:', error)\n    throw error\n  }\n}\n\n/**\n * Generate interview questions\n */\nexport async function generateInterviewQuestions(manuscript, count = 10) {\n  try {\n    const prompt = `أنشئ ${count} أسئلة مقابلة للمؤلف:\n\nالكتاب:\nالعنوان: ${manuscript.title}\nالمؤلف: ${manuscript.author}\nالملخص: ${manuscript.description || ''}\n\nالأسئلة يجب أن:\n1. تكون عميقة وذات معنى\n2. تثير اهتمام المستمعين\n3. تكشف عن شخصية المؤلف\n4. تتعلق بعملية الكتابة\n5. تتعلق بالرسالة الرئيسية للكتاب\n\nأعد الأسئلة مرقمة، واحد في كل سطر.`\n\n    const response = await generateContent(prompt)\n    const questions = response\n      .split('\\n')\n      .filter(line => line.trim())\n      .map(line => line.replace(/^\\d+\\.\\s*/, '').trim())\n      .filter(line => line.length > 0)\n      .slice(0, count)\n\n    return questions\n  } catch (error) {\n    console.error('Interview questions error:', error)\n    throw error\n  }\n}\n\n/**\n * Generate content repurposing ideas\n */\nexport async function generateRepurposingIdeas(manuscript) {\n  try {\n    const prompt = `اقترح طرقاً لإعادة استخدام محتوى الكتاب:\n\nالكتاب: ${manuscript.title}\nالنوع: ${manuscript.genre}\n\nاقترح:\n1. 5 أفكار فيديو\n2. 5 أفكار بودكاست\n3. 5 أفكار مقالات\n4. 5 أفكار إنفوجرافيك\n5. 5 أفكار ويبينار\n6. 5 أفكار دورات تدريبية\n\nاجعل الأفكار عملية وقابلة للتطبيق.`\n\n    const ideas = await generateContent(prompt)\n    return parseRepurposingIdeas(ideas)\n  } catch (error) {\n    console.error('Repurposing ideas error:', error)\n    throw error\n  }\n}\n\n/**\n * Parse repurposing ideas\n */\nfunction parseRepurposingIdeas(text) {\n  const sections = text.split(/\\n\\d\\.\\s+/)\n  return {\n    videos: extractItems(sections[1] || ''),\n    podcasts: extractItems(sections[2] || ''),\n    articles: extractItems(sections[3] || ''),\n    infographics: extractItems(sections[4] || ''),\n    webinars: extractItems(sections[5] || ''),\n    courses: extractItems(sections[6] || '')\n  }\n}\n\n/**\n * Extract items from text\n */\nfunction extractItems(text) {\n  return text\n    .split('\\n')\n    .map(line => line.replace(/^[-•*]\\s*/, '').trim())\n    .filter(line => line.length > 0)\n    .slice(0, 5)\n}\n
