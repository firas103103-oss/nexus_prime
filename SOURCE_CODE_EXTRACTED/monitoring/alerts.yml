# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# ðŸ”” NEXUS PRIME - Prometheus Alert Rules
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

groups:
  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  # ðŸ–¥ï¸ System Resources Alerts
  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  - name: system_resources
    interval: 30s
    rules:
      - alert: HighCPUUsage
        expr: 100 - (avg by(instance) (rate(node_cpu_seconds_total{mode="idle"}[5m])) * 100) > 80
        for: 5m
        labels:
          severity: warning
          component: system
        annotations:
          summary: "Ø§Ø³ØªÙ‡Ù„Ø§Ùƒ CPU Ø¹Ø§Ù„ÙŠ Ø¹Ù„Ù‰ {{ $labels.instance }}"
          description: "Ø§Ø³ØªÙ‡Ù„Ø§Ùƒ CPU: {{ $value | humanize }}% Ù„Ø£ÙƒØ«Ø± Ù…Ù† 5 Ø¯Ù‚Ø§Ø¦Ù‚"

      - alert: HighMemoryUsage
        expr: (node_memory_MemTotal_bytes - node_memory_MemAvailable_bytes) / node_memory_MemTotal_bytes * 100 > 85
        for: 5m
        labels:
          severity: warning
          component: system
        annotations:
          summary: "Ø§Ø³ØªÙ‡Ù„Ø§Ùƒ Ø§Ù„Ø°Ø§ÙƒØ±Ø© Ø¹Ø§Ù„ÙŠ Ø¹Ù„Ù‰ {{ $labels.instance }}"
          description: "Ø§Ø³ØªÙ‡Ù„Ø§Ùƒ Ø§Ù„Ø°Ø§ÙƒØ±Ø©: {{ $value | humanize }}%"

      - alert: DiskSpaceLow
        expr: (node_filesystem_avail_bytes{mountpoint="/"} / node_filesystem_size_bytes{mountpoint="/"}) * 100 < 15
        for: 10m
        labels:
          severity: critical
          component: system
        annotations:
          summary: "Ù…Ø³Ø§Ø­Ø© Ø§Ù„Ù‚Ø±Øµ Ù…Ù†Ø®ÙØ¶Ø© Ø¬Ø¯Ø§Ù‹"
          description: "Ø§Ù„Ù…Ø³Ø§Ø­Ø© Ø§Ù„Ù…ØªØ¨Ù‚ÙŠØ©: {{ $value | humanize }}%"

  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  # ðŸ³ Container Health Alerts
  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  - name: containers
    interval: 30s
    rules:
      - alert: ContainerDown
        expr: up == 0
        for: 2m
        labels:
          severity: critical
          component: container
        annotations:
          summary: "Ø§Ù„Ø­Ø§ÙˆÙŠØ© {{ $labels.job }} Ù…ØªÙˆÙ‚ÙØ©"
          description: "Ø§Ù„Ø­Ø§ÙˆÙŠØ© {{ $labels.job }} Ø¹Ù„Ù‰ {{ $labels.instance }} Ù„Ø§ ØªØ³ØªØ¬ÙŠØ¨"

      - alert: ContainerHighMemory
        expr: (container_memory_usage_bytes / container_spec_memory_limit_bytes) * 100 > 90
        for: 5m
        labels:
          severity: warning
          component: container
        annotations:
          summary: "Ø§Ø³ØªÙ‡Ù„Ø§Ùƒ Ø°Ø§ÙƒØ±Ø© Ø¹Ø§Ù„ÙŠ ÙÙŠ Ø§Ù„Ø­Ø§ÙˆÙŠØ© {{ $labels.name }}"
          description: "Ø§Ø³ØªÙ‡Ù„Ø§Ùƒ: {{ $value | humanize }}%"

      - alert: ContainerRestartingTooOften
        expr: rate(container_last_seen{name!=""}[5m]) > 0.1
        for: 10m
        labels:
          severity: warning
          component: container
        annotations:
          summary: "Ø§Ù„Ø­Ø§ÙˆÙŠØ© {{ $labels.name }} ØªØ¹ÙŠØ¯ Ø§Ù„ØªØ´ØºÙŠÙ„ Ø¨Ø´ÙƒÙ„ Ù…ØªÙƒØ±Ø±"
          description: "Ù…Ø¹Ø¯Ù„ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªØ´ØºÙŠÙ„: {{ $value | humanize }}"

  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  # ðŸ—„ï¸ Database Alerts
  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  - name: database
    interval: 30s
    rules:
      - alert: PostgreSQLDown
        expr: up{job="postgres"} == 0
        for: 1m
        labels:
          severity: critical
          component: database
        annotations:
          summary: "Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª PostgreSQL Ù…ØªÙˆÙ‚ÙØ©"
          description: "Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ø§ ØªØ³ØªØ¬ÙŠØ¨ Ù…Ù†Ø° Ø£ÙƒØ«Ø± Ù…Ù† Ø¯Ù‚ÙŠÙ‚Ø©"

      - alert: PostgreSQLTooManyConnections
        expr: sum(pg_stat_activity_count) > 80
        for: 5m
        labels:
          severity: warning
          component: database
        annotations:
          summary: "Ø¹Ø¯Ø¯ Ø§Ù„Ø§ØªØµØ§Ù„Ø§Øª Ø¨Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø±ØªÙØ¹"
          description: "Ø¹Ø¯Ø¯ Ø§Ù„Ø§ØªØµØ§Ù„Ø§Øª Ø§Ù„Ø­Ø§Ù„ÙŠØ©: {{ $value }} Ù…Ù† Ø£ØµÙ„ 100"

      - alert: PostgreSQLSlowQueries
        expr: rate(pg_stat_statements_mean_time_seconds[5m]) > 1
        for: 5m
        labels:
          severity: warning
          component: database
        annotations:
          summary: "Ø§Ø³ØªØ¹Ù„Ø§Ù…Ø§Øª Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ø·ÙŠØ¦Ø©"
          description: "Ù…ØªÙˆØ³Ø· ÙˆÙ‚Øª Ø§Ù„Ø§Ø³ØªØ¹Ù„Ø§Ù…: {{ $value | humanize }} Ø«Ø§Ù†ÙŠØ©"

  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  # ðŸ¤– AI/LLM Alerts
  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  - name: ai_services
    interval: 30s
    rules:
      - alert: OllamaDown
        expr: up{job="ollama"} == 0
        for: 2m
        labels:
          severity: critical
          component: ai
        annotations:
          summary: "Ù…Ø­Ø±Ùƒ Ollama Ù…ØªÙˆÙ‚Ù"
          description: "Ù…Ø­Ø±Ùƒ Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ Ù„Ø§ ÙŠØ³ØªØ¬ÙŠØ¨"

      - alert: LiteLLMHighLatency
        expr: histogram_quantile(0.95, rate(http_request_duration_seconds_bucket{job="litellm"}[5m])) > 30
        for: 5m
        labels:
          severity: warning
          component: ai
        annotations:
          summary: "ÙˆÙ‚Øª Ø§Ø³ØªØ¬Ø§Ø¨Ø© LiteLLM Ø¹Ø§Ù„ÙŠ"
          description: "95th percentile: {{ $value | humanize }} Ø«Ø§Ù†ÙŠØ©"

      - alert: LiteLLMHighErrorRate
        expr: rate(http_requests_total{job="litellm",status=~"5.."}[5m]) / rate(http_requests_total{job="litellm"}[5m]) > 0.05
        for: 5m
        labels:
          severity: warning
          component: ai
        annotations:
          summary: "Ù…Ø¹Ø¯Ù„ Ø£Ø®Ø·Ø§Ø¡ Ø¹Ø§Ù„ÙŠ ÙÙŠ LiteLLM"
          description: "Ù…Ø¹Ø¯Ù„ Ø§Ù„Ø£Ø®Ø·Ø§Ø¡: {{ $value | humanizePercentage }}"

  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  # ðŸŒ API Gateway Alerts
  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  - name: api_gateway
    interval: 30s
    rules:
      - alert: CortexHighErrorRate
        expr: rate(http_requests_total{job="nexus_cortex",status=~"5.."}[5m]) / rate(http_requests_total{job="nexus_cortex"}[5m]) > 0.05
        for: 5m
        labels:
          severity: warning
          component: api
        annotations:
          summary: "Ù…Ø¹Ø¯Ù„ Ø£Ø®Ø·Ø§Ø¡ Ø¹Ø§Ù„ÙŠ ÙÙŠ Cortex"
          description: "Ù…Ø¹Ø¯Ù„ Ø§Ù„Ø£Ø®Ø·Ø§Ø¡: {{ $value | humanizePercentage }}"

      - alert: CortexHighLatency
        expr: histogram_quantile(0.95, rate(http_request_duration_seconds_bucket{job="nexus_cortex"}[5m])) > 5
        for: 5m
        labels:
          severity: warning
          component: api
        annotations:
          summary: "ÙˆÙ‚Øª Ø§Ø³ØªØ¬Ø§Ø¨Ø© Cortex Ø¹Ø§Ù„ÙŠ"
          description: "95th percentile: {{ $value | humanize }} Ø«Ø§Ù†ÙŠØ©"

  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  # ðŸ’¾ Redis Alerts
  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  - name: redis
    interval: 30s
    rules:
      - alert: RedisDown
        expr: up{job="redis"} == 0
        for: 1m
        labels:
          severity: critical
          component: cache
        annotations:
          summary: "Redis Ù…ØªÙˆÙ‚Ù"
          description: "Ø®Ø¯Ù…Ø© Ø§Ù„ØªØ®Ø²ÙŠÙ† Ø§Ù„Ù…Ø¤Ù‚Øª Redis Ù„Ø§ ØªØ³ØªØ¬ÙŠØ¨"

      - alert: RedisMemoryHigh
        expr: redis_memory_used_bytes / redis_memory_max_bytes * 100 > 90
        for: 5m
        labels:
          severity: warning
          component: cache
        annotations:
          summary: "Ø§Ø³ØªÙ‡Ù„Ø§Ùƒ Ø°Ø§ÙƒØ±Ø© Redis Ø¹Ø§Ù„ÙŠ"
          description: "Ø§Ø³ØªÙ‡Ù„Ø§Ùƒ Ø§Ù„Ø°Ø§ÙƒØ±Ø©: {{ $value | humanize }}%"
