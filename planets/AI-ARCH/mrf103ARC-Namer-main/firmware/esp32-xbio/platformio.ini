; ═══════════════════════════════════════════════════════════════════════════════
; xBio Sentinel - ESP32-S3 N16R8 + BME688 PlatformIO Configuration
; MRF103 ARC Environmental Monitoring System
; ═══════════════════════════════════════════════════════════════════════════════

[env:esp32s3-xbio]
platform = espressif32
board = esp32-s3-devkitc-1
framework = arduino
board_build.mcu = esp32s3
board_build.f_cpu = 240000000L

; ═══════════════════════════════════════════════════════════════════════════════
; Memory Configuration - N16R8 (16MB Flash, 8MB PSRAM)
; ═══════════════════════════════════════════════════════════════════════════════
board_build.flash_mode = qio
board_build.flash_size = 16MB
board_build.partitions = partitions_custom.csv
board_upload.flash_size = 16MB

; Enable PSRAM
board_build.arduino.memory_type = qio_opi
build_flags = 
    -DBOARD_HAS_PSRAM
    -DARDUINO_USB_MODE=1
    -DARDUINO_USB_CDC_ON_BOOT=1
    -DCORE_DEBUG_LEVEL=3
    
    ; xBio Sentinel Configuration
    -DXBIO_VERSION=\"1.0.0\"
    -DXBIO_DEVICE_PREFIX=\"XBIO\"
    
    ; BME688 I2C Pins
    -DBME688_SDA=8
    -DBME688_SCL=9
    -DBME688_I2C_ADDR=0x77
    
    ; LED Pins
    -DLED_STATUS_PIN=2
    -DLED_ERROR_PIN=4
    
    ; Button Pins
    -DBUTTON_CONFIG_PIN=0
    -DBUTTON_RESET_PIN=3
    
    ; WiFi Configuration
    -DWIFI_CONNECT_TIMEOUT=30000
    -DWIFI_RETRY_INTERVAL=5000
    
    ; MQTT Configuration
    -DMQTT_RECONNECT_INTERVAL=5000
    -DMQTT_KEEPALIVE=60
    
    ; Sensor Configuration
    -DSENSOR_READ_INTERVAL=1000
    -DSENSOR_CALIBRATION_TIME=300000
    
    ; Enable features
    -DENABLE_BLE_PROVISIONING=1
    -DENABLE_OTA_UPDATES=1
    -DENABLE_DEEP_SLEEP=1
    -DENABLE_WEBSOCKET=1

; ═══════════════════════════════════════════════════════════════════════════════
; Library Dependencies
; ═══════════════════════════════════════════════════════════════════════════════
lib_deps = 
    ; Bosch BME68x Sensor Library
    boschsensortec/BSEC Software Library@^1.8.1492
    boschsensortec/BME68x Sensor library@^1.1.40407
    
    ; Communication Libraries
    knolleary/PubSubClient@^2.8
    links2004/WebSockets@^2.4.1
    bblanchon/ArduinoJson@^7.0.4
    
    ; Storage and Configuration
    me-no-dev/AsyncTCP@^1.1.1
    me-no-dev/ESPAsyncWebServer@^1.2.6
    
    ; BLE
    h2zero/NimBLE-Arduino@^1.4.1
    
    ; Utilities
    tzapu/WiFiManager@^2.0.16-rc.2
    ayushsharma82/ElegantOTA@^3.1.1

; ═══════════════════════════════════════════════════════════════════════════════
; Upload Configuration
; ═══════════════════════════════════════════════════════════════════════════════
upload_speed = 921600
monitor_speed = 115200
monitor_filters = esp32_exception_decoder

; OTA Upload (uncomment when device is configured)
; upload_protocol = espota
; upload_port = xbio-device.local

; ═══════════════════════════════════════════════════════════════════════════════
; Debug Configuration
; ═══════════════════════════════════════════════════════════════════════════════
[env:esp32s3-xbio-debug]
extends = env:esp32s3-xbio
build_type = debug
build_flags = 
    ${env:esp32s3-xbio.build_flags}
    -DCORE_DEBUG_LEVEL=5
    -DXBIO_DEBUG=1
    -DENABLE_SERIAL_DEBUG=1

; ═══════════════════════════════════════════════════════════════════════════════
; Production Configuration
; ═══════════════════════════════════════════════════════════════════════════════
[env:esp32s3-xbio-release]
extends = env:esp32s3-xbio
build_type = release
build_flags = 
    ${env:esp32s3-xbio.build_flags}
    -DCORE_DEBUG_LEVEL=0
    -DXBIO_DEBUG=0
    -Os
