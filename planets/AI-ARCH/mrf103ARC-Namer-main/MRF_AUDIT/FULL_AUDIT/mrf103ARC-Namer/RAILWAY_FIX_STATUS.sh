#!/bin/bash

# ğŸš¨ Railway Deployment Fix - Quick Checklist

echo "=================================================="
echo "ğŸ”§ RAILWAY 502 ERROR - FIX CHECKLIST"
echo "=================================================="
echo ""

echo "âœ… COMPLETED:"
echo "  1. Removed hardcoded ENV PORT=9002 from Dockerfile"
echo "  2. Committed and pushed changes to GitHub (commit: aaa9dd8)"
echo ""

echo "ğŸ“‹ NEXT STEPS (Manual on Railway Dashboard):"
echo ""
echo "1. Go to: https://railway.app"
echo "   â””â”€ Select project: mrf103ARC-Namer"
echo ""
echo "2. Check 'Variables' tab:"
echo "   â”œâ”€ If PORT exists â†’ DELETE IT"
echo "   â”œâ”€ Railway auto-injects PORT dynamically"
echo "   â””â”€ Required vars:"
echo "      â”œâ”€ DATABASE_URL âœ“"
echo "      â”œâ”€ SUPABASE_URL âœ“"
echo "      â”œâ”€ SUPABASE_KEY âœ“"
echo "      â”œâ”€ ARC_OPERATOR_PASSWORD âœ“"
echo "      â”œâ”€ SESSION_SECRET âœ“"
echo "      â””â”€ NODE_ENV=production âœ“"
echo ""
echo "3. Monitor Deployment:"
echo "   â”œâ”€ Railway should auto-deploy from GitHub push"
echo "   â”œâ”€ Watch logs for: 'âœ… Server is live and listening on port XXXX'"
echo "   â””â”€ Wait 2-3 minutes"
echo ""
echo "4. Test the Fix:"
echo "   $ curl -I https://app.mrf103.com"
echo "   Expected: HTTP/2 200"
echo ""
echo "   $ curl https://app.mrf103.com/api/health"
echo "   Expected: {\"status\":\"healthy\",...}"
echo ""

echo "=================================================="
echo "ğŸ” TROUBLESHOOTING:"
echo "=================================================="
echo ""
echo "If still 502:"
echo "  1. Check Railway logs for errors:"
echo "     - EADDRINUSE (port conflict)"
echo "     - Database connection errors"
echo "     - Missing environment variables"
echo ""
echo "  2. Verify build succeeded:"
echo "     - Build command: npm run build"
echo "     - Check dist/ folder was created"
echo "     - Start command: npm start"
echo ""
echo "  3. Manual redeploy:"
echo "     Railway Dashboard â†’ Deploy â†’ Trigger Deploy"
echo ""

echo "=================================================="
echo "ğŸ“Š Expected Railway Logs:"
echo "=================================================="
echo ""
echo "[Railway] Building from commit aaa9dd8..."
echo "[Railway] Running: npm run build"
echo "[Railway] Build complete"
echo "[Railway] Starting: npm start"
echo "[App] âœ… Server is live and listening on 0.0.0.0:XXXX"
echo "[App] ğŸŒ Environment: production"
echo "[App] Database connected"
echo "[App] Supabase initialized"
echo ""

echo "=================================================="
echo "Last updated: $(date)"
echo "=================================================="
