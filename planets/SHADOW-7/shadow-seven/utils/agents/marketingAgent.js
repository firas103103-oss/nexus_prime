/**\n * Marketing Agent\n * Generates marketing copy, descriptions, and promotional content\n */\n\nimport { generateContent, streamGenerate } from '@/api/geminiClient'\nimport { analyzeText } from '@/utils/nlp/contentClassifier'\n\nconst MARKETING_PROMPT = `أنت خبير تسويق محترف متخصص في تسويق الكتب والمحتوى الأدبي.\nمهمتك هي إنشاء نصوص تسويقية جذابة وفعالة.\n\nالكتاب:\nالعنوان: {title}\nالمؤلف: {author}\nالوصف: {description}\nالنوع: {genre}\nالملخص: {summary}\n\nأنشئ:\n1. وصف قصير (50 كلمة) للمتجر\n2. وصف متوسط (150 كلمة) للموقع\n3. وصف طويل (300 كلمة) للمراجعة\n4. 5 نقاط رئيسية للبيع\n5. 3 عناوين بديلة للكتاب\n6. كلمات مفتاحية (10 كلمات)\n\nتأكد من:\n- استخدام لغة جذابة وإقناعية\n- التركيز على الفوائد والقيمة\n- مناسبة للجمهور المستهدف\n- خالية من الأخطاء الإملائية`\n\n/**\n * Generate marketing content for a manuscript\n */\nexport async function generateMarketingContent(manuscript, onProgress) {\n  try {\n    const prompt = MARKETING_PROMPT\n      .replace('{title}', manuscript.title || '')\n      .replace('{author}', manuscript.author || '')\n      .replace('{description}', manuscript.description || '')\n      .replace('{genre}', manuscript.genre || '')\n      .replace('{summary}', manuscript.content?.substring(0, 500) || '')\n\n    let fullContent = ''\n\n    // Stream the response\n    await streamGenerate(prompt, (chunk) => {\n      fullContent += chunk\n      if (onProgress) onProgress(fullContent)\n    })\n\n    // Parse the response\n    const content = parseMarketingResponse(fullContent)\n\n    return {\n      success: true,\n      data: content,\n      raw: fullContent\n    }\n  } catch (error) {\n    console.error('Marketing agent error:', error)\n    throw new Error(`فشل توليد المحتوى التسويقي: ${error.message}`)\n  }\n}\n\n/**\n * Parse marketing response\n */\nfunction parseMarketingResponse(response) {\n  const sections = response.split(/\\n(?=\\d\\.)/)\n\n  return {\n    shortDescription: extractSection(response, 'وصف قصير'),\n    mediumDescription: extractSection(response, 'وصف متوسط'),\n    longDescription: extractSection(response, 'وصف طويل'),\n    sellingPoints: extractList(response, 'نقاط رئيسية'),\n    alternativeTitles: extractList(response, 'عناوين بديلة'),\n    keywords: extractList(response, 'كلمات مفتاحية')\n  }\n}\n\n/**\n * Extract section from response\n */\nfunction extractSection(text, keyword) {\n  const regex = new RegExp(`${keyword}[^\\n]*\\n([\\s\\S]*?)(?=\\n\\d\\.|$)`, 'i')\n  const match = text.match(regex)\n  return match ? match[1].trim() : ''\n}\n\n/**\n * Extract list items from response\n */\nfunction extractList(text, keyword) {\n  const regex = new RegExp(`${keyword}[^\\n]*\\n([\\s\\S]*?)(?=\\n\\d\\.|$)`, 'i')\n  const match = text.match(regex)\n  if (!match) return []\n\n  return match[1]\n    .split('\\n')\n    .filter(line => line.trim())\n    .map(line => line.replace(/^[-•*]\\s*/, '').trim())\n    .filter(line => line.length > 0)\n}\n\n/**\n * Optimize marketing content for SEO\n */\nexport async function optimizeForSEO(content, keywords) {\n  try {\n    const prompt = `أنت خبير SEO متخصص في تحسين محتوى الكتب.\n\nالمحتوى الحالي:\n${content}\n\nالكلمات المفتاحية المستهدفة:\n${keywords.join(', ')}\n\nحسّن المحتوى ل SEO:\n1. أضف الكلمات المفتاحية بشكل طبيعي\n2. حسّن البنية والتنسيق\n3. أضف عناوين فرعية\n4. حسّن الجملة الأولى\n5. أضف call-to-action\n\nأعد المحتوى المحسّن فقط بدون شرح.`\n\n    const optimized = await generateContent(prompt)\n    return optimized\n  } catch (error) {\n    console.error('SEO optimization error:', error)\n    throw error\n  }\n}\n\n/**\n * Generate A/B testing variations\n */\nexport async function generateABVariations(content, count = 3) {\n  try {\n    const prompt = `أنت متخصص في A/B testing للمحتوى التسويقي.\n\nالمحتوى الأصلي:\n${content}\n\nأنشئ ${count} نسخ بديلة من نفس المحتوى مع:\n1. تغيير الأسلوب والنبرة\n2. إعادة ترتيب النقاط\n3. تغيير الكلمات الرئيسية\n4. تحسين الجاذبية\n\nأعد كل نسخة برقم (1, 2, 3...) وفاصل واضح.`\n\n    const variations = await generateContent(prompt)\n    return parseVariations(variations, count)\n  } catch (error) {\n    console.error('A/B variation error:', error)\n    throw error\n  }\n}\n\n/**\n * Parse variations\n */\nfunction parseVariations(text, count) {\n  const variations = []\n  for (let i = 1; i <= count; i++) {\n    const regex = new RegExp(`${i}\\.\\s*([\\s\\S]*?)(?=${i + 1}\\.\\s*|$)`, 'i')\n    const match = text.match(regex)\n    if (match) {\n      variations.push({\n        id: i,\n        content: match[1].trim()\n      })\n    }\n  }\n  return variations\n}\n\n/**\n * Analyze marketing effectiveness\n */\nexport async function analyzeMarketingEffectiveness(content) {\n  try {\n    const analysis = analyzeText(content)\n\n    const prompt = `قيّم فعالية هذا المحتوى التسويقي:\n\n${content}\n\nقدّم تقييماً يتضمن:\n1. درجة الجاذبية (1-10)\n2. درجة الوضوح (1-10)\n3. درجة الإقناع (1-10)\n4. نقاط القوة\n5. نقاط الضعف\n6. التوصيات للتحسين`\n\n    const evaluation = await generateContent(prompt)\n    return {\n      analysis,\n      evaluation\n    }\n  } catch (error) {\n    console.error('Effectiveness analysis error:', error)\n    throw error\n  }\n}\n
