<!DOCTYPE html>
<html lang="en-US">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>XBio Field Controller - Digital Nose System</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 50%, #334155 100%);
            color: #f1f5f9;
            min-height: 100vh;
            overflow-x: hidden;
        }

        .header {
            padding: 2rem;
            background: rgba(15, 23, 42, 0.8);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid rgba(148, 163, 184, 0.1);
        }

        .header-content {
            max-width: 1400px;
            margin: 0 auto;
        }

        .header h1 {
            font-size: 2.5rem;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 0.5rem;
        }

        .header-subtitle {
            color: #94a3b8;
            font-size: 1rem;
            display: flex;
            gap: 1rem;
            align-items: center;
        }

        .status-badge {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.25rem 0.75rem;
            background: rgba(34, 197, 94, 0.2);
            border: 1px solid rgba(34, 197, 94, 0.3);
            border-radius: 1rem;
            font-size: 0.875rem;
            color: #86efac;
        }

        .status-dot {
            width: 8px;
            height: 8px;
            background: #22c55e;
            border-radius: 50%;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 2rem;
        }

        .sensor-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .sensor-card {
            background: rgba(30, 41, 59, 0.6);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(148, 163, 184, 0.2);
            border-radius: 1rem;
            padding: 1.5rem;
            transition: all 0.3s ease;
        }

        .sensor-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 12px 24px rgba(0, 0, 0, 0.3);
            border-color: rgba(148, 163, 184, 0.4);
        }

        .sensor-card-header {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            margin-bottom: 1rem;
        }

        .sensor-icon {
            width: 40px;
            height: 40px;
            border-radius: 0.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.25rem;
        }

        .sensor-label {
            font-size: 0.875rem;
            color: #94a3b8;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .sensor-value {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
        }

        .sensor-trend {
            font-size: 0.875rem;
            display: flex;
            align-items: center;
            gap: 0.25rem;
        }

        .trend-up { color: #86efac; }
        .trend-down { color: #fca5a5; }
        .trend-stable { color: #fcd34d; }

        .agent-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .agent-card {
            background: rgba(30, 41, 59, 0.6);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(148, 163, 184, 0.2);
            border-radius: 1rem;
            padding: 1.5rem;
            transition: all 0.3s ease;
        }

        .agent-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 12px 24px rgba(0, 0, 0, 0.3);
        }

        .agent-header {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .agent-emoji {
            font-size: 2.5rem;
        }

        .agent-info h3 {
            font-size: 1.25rem;
            margin-bottom: 0.25rem;
        }

        .agent-name-ar {
            font-size: 0.875rem;
            color: #94a3b8;
        }

        .agent-role {
            color: #cbd5e1;
            font-size: 0.875rem;
            margin-bottom: 1rem;
        }

        .agent-status {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem;
            background: rgba(15, 23, 42, 0.5);
            border-radius: 0.5rem;
            font-size: 0.875rem;
        }

        .chart-container {
            background: rgba(30, 41, 59, 0.6);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(148, 163, 184, 0.2);
            border-radius: 1rem;
            padding: 1.5rem;
            margin-bottom: 2rem;
        }

        .chart-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .chart-title {
            font-size: 1.25rem;
            font-weight: 600;
        }

        .chart-controls {
            display: flex;
            gap: 0.5rem;
        }

        .chart-btn {
            padding: 0.5rem 1rem;
            background: rgba(51, 65, 85, 0.8);
            border: 1px solid rgba(148, 163, 184, 0.2);
            border-radius: 0.5rem;
            color: #e2e8f0;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 0.875rem;
        }

        .chart-btn:hover {
            background: rgba(71, 85, 105, 0.8);
        }

        .chart-btn.active {
            background: rgba(59, 130, 246, 0.3);
            border-color: #3b82f6;
            color: #93c5fd;
        }

        canvas {
            width: 100%;
            height: 300px;
        }

        .controls-panel {
            background: rgba(30, 41, 59, 0.6);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(148, 163, 184, 0.2);
            border-radius: 1rem;
            padding: 1.5rem;
            margin-bottom: 2rem;
        }

        .controls-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
        }

        .control-group {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .control-label {
            font-size: 0.875rem;
            color: #94a3b8;
        }

        .control-input {
            padding: 0.75rem;
            background: rgba(15, 23, 42, 0.5);
            border: 1px solid rgba(148, 163, 184, 0.2);
            border-radius: 0.5rem;
            color: #e2e8f0;
            font-size: 0.875rem;
        }

        .control-input:focus {
            outline: none;
            border-color: #3b82f6;
        }

        .btn {
            padding: 0.75rem 1.5rem;
            background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
            border: none;
            border-radius: 0.5rem;
            color: white;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 0.875rem;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 16px rgba(59, 130, 246, 0.4);
        }

        .btn-secondary {
            background: linear-gradient(135deg, #64748b 0%, #475569 100%);
        }

        .alert-panel {
            background: rgba(30, 41, 59, 0.6);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(148, 163, 184, 0.2);
            border-radius: 1rem;
            padding: 1.5rem;
            margin-bottom: 2rem;
        }

        .alert-item {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1rem;
            background: rgba(239, 68, 68, 0.1);
            border-left: 3px solid #ef4444;
            border-radius: 0.5rem;
            margin-bottom: 0.75rem;
        }

        .alert-icon {
            color: #ef4444;
            font-size: 1.25rem;
        }

        .alert-content {
            flex: 1;
        }

        .alert-message {
            font-weight: 600;
            margin-bottom: 0.25rem;
        }

        .alert-time {
            font-size: 0.75rem;
            color: #94a3b8;
        }

        .tab-container {
            margin-bottom: 2rem;
        }

        .tabs {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1.5rem;
            border-bottom: 1px solid rgba(148, 163, 184, 0.2);
        }

        .tab {
            padding: 0.75rem 1.5rem;
            background: transparent;
            border: none;
            color: #94a3b8;
            cursor: pointer;
            transition: all 0.2s;
            border-bottom: 2px solid transparent;
            font-size: 0.875rem;
            font-weight: 600;
        }

        .tab:hover {
            color: #e2e8f0;
        }

        .tab.active {
            color: #3b82f6;
            border-bottom-color: #3b82f6;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .connection-status {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 1rem;
            background: rgba(15, 23, 42, 0.5);
            border-radius: 0.5rem;
            font-size: 0.875rem;
        }

        .footer {
            text-align: center;
            padding: 2rem;
            color: #64748b;
            font-size: 0.875rem;
            border-top: 1px solid rgba(148, 163, 184, 0.1);
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="header-content">
            <h1>
                <span style="font-size: 3rem;">üß¨</span>
                XBio Field Controller
            </h1>
            <div class="header-subtitle">
                <span>Digital Nose System - ŸÖÿ±ŸÉÿ≤ xBio ÿßŸÑŸÖÿ™ŸÇÿØŸÖ</span>
                <span class="status-badge">
                    <span class="status-dot"></span>
                    System Active
                </span>
                <span class="connection-status">
                    <span>üì°</span>
                    <span id="deviceId">Device: XB-S3-001</span>
                </span>
            </div>
        </div>
    </div>

    <div class="container">
        <div class="tab-container">
            <div class="tabs">
                <button class="tab active" onclick="switchTab('dashboard')">Dashboard</button>
                <button class="tab" onclick="switchTab('analysis')">AI Analysis</button>
                <button class="tab" onclick="switchTab('profiles')">Smell Profiles</button>
                <button class="tab" onclick="switchTab('settings')">Settings</button>
            </div>

            <div id="dashboard" class="tab-content active">
                <div class="sensor-grid">
                    <div class="sensor-card">
                        <div class="sensor-card-header">
                            <div class="sensor-icon" style="background: rgba(239, 68, 68, 0.2); color: #ef4444;">üå°Ô∏è</div>
                            <div class="sensor-label">Temperature</div>
                        </div>
                        <div class="sensor-value" id="temperature">24.5¬∞C</div>
                        <div class="sensor-trend trend-up">‚Üë +0.3¬∞C</div>
                    </div>

                    <div class="sensor-card">
                        <div class="sensor-card-header">
                            <div class="sensor-icon" style="background: rgba(59, 130, 246, 0.2); color: #3b82f6;">üíß</div>
                            <div class="sensor-label">Humidity</div>
                        </div>
                        <div class="sensor-value" id="humidity">45%</div>
                        <div class="sensor-trend trend-stable">‚Üí Stable</div>
                    </div>

                    <div class="sensor-card">
                        <div class="sensor-card-header">
                            <div class="sensor-icon" style="background: rgba(168, 85, 247, 0.2); color: #a855f7;">‚ö°</div>
                            <div class="sensor-label">Pressure</div>
                        </div>
                        <div class="sensor-value" id="pressure">1013 hPa</div>
                        <div class="sensor-trend trend-down">‚Üì -2 hPa</div>
                    </div>

                    <div class="sensor-card">
                        <div class="sensor-card-header">
                            <div class="sensor-icon" style="background: rgba(20, 184, 166, 0.2); color: #14b8a6;">üî¨</div>
                            <div class="sensor-label">Gas Resistance</div>
                        </div>
                        <div class="sensor-value" id="gasResistance">150K Œ©</div>
                        <div class="sensor-trend trend-up">‚Üë +5K Œ©</div>
                    </div>

                    <div class="sensor-card">
                        <div class="sensor-card-header">
                            <div class="sensor-icon" style="background: rgba(34, 197, 94, 0.2); color: #22c55e;">üìä</div>
                            <div class="sensor-label">Air Quality</div>
                        </div>
                        <div class="sensor-value" id="airQuality">92%</div>
                        <div class="sensor-trend trend-up">‚Üë Excellent</div>
                    </div>
                </div>

                <div class="chart-container">
                    <div class="chart-header">
                        <div class="chart-title">Real-time Sensor Data</div>
                        <div class="chart-controls">
                            <button class="chart-btn active" onclick="setChartRange('1h')">1H</button>
                            <button class="chart-btn" onclick="setChartRange('6h')">6H</button>
                            <button class="chart-btn" onclick="setChartRange('24h')">24H</button>
                        </div>
                    </div>
                    <canvas id="sensorChart"></canvas>
                </div>

                <div class="agent-grid">
                    <div class="agent-card">
                        <div class="agent-header">
                            <div class="agent-emoji">üëÉ</div>
                            <div class="agent-info">
                                <h3>Olfactory Agent</h3>
                                <div class="agent-name-ar">ÿßŸÑÿ¥ŸÖŸä</div>
                            </div>
                        </div>
                        <div class="agent-role">Smell Detection & Classification</div>
                        <div class="agent-status">
                            <span style="color: #22c55e;">‚óè</span>
                            <span>Active - Monitoring</span>
                        </div>
                    </div>

                    <div class="agent-card">
                        <div class="agent-header">
                            <div class="agent-emoji">üß†</div>
                            <div class="agent-info">
                                <h3>Instinct Agent</h3>
                                <div class="agent-name-ar">ÿßŸÑÿ∫ÿ±Ÿäÿ≤ÿ©</div>
                            </div>
                        </div>
                        <div class="agent-role">Digital Instinct Analysis</div>
                        <div class="agent-status">
                            <span style="color: #22c55e;">‚óè</span>
                            <span>Processing - AI Active</span>
                        </div>
                    </div>

                    <div class="agent-card">
                        <div class="agent-header">
                            <div class="agent-emoji">üåç</div>
                            <div class="agent-info">
                                <h3>Environ Agent</h3>
                                <div class="agent-name-ar">ÿßŸÑÿ®Ÿäÿ¶ÿ©</div>
                            </div>
                        </div>
                        <div class="agent-role">Environmental Analysis</div>
                        <div class="agent-status">
                            <span style="color: #22c55e;">‚óè</span>
                            <span>Scanning Environment</span>
                        </div>
                    </div>

                    <div class="agent-card">
                        <div class="agent-header">
                            <div class="agent-emoji">üì°</div>
                            <div class="agent-info">
                                <h3>Sensor Agent</h3>
                                <div class="agent-name-ar">ÿßŸÑŸÖÿ≥ÿ™ÿ¥ÿπÿ±</div>
                            </div>
                        </div>
                        <div class="agent-role">Hardware & Sensor Management</div>
                        <div class="agent-status">
                            <span style="color: #22c55e;">‚óè</span>
                            <span>BME688 Connected</span>
                        </div>
                    </div>
                </div>

                <div class="alert-panel">
                    <h3 style="margin-bottom: 1rem;">System Alerts</h3>
                    <div id="alertsContainer">
                        <div style="text-align: center; color: #94a3b8; padding: 2rem;">
                            No active alerts
                        </div>
                    </div>
                </div>
            </div>

            <div id="analysis" class="tab-content">
                <div class="controls-panel">
                    <h3 style="margin-bottom: 1rem;">AI-Powered Analysis</h3>
                    <div class="control-group" style="margin-bottom: 1rem;">
                        <label class="control-label">Ask a question about your air quality data:</label>
                        <textarea id="analysisQuery" class="control-input" rows="3" placeholder="e.g., What patterns do you see in my air quality over the last 24 hours?"></textarea>
                    </div>
                    <button class="btn" onclick="runAnalysis()">üß† Analyze with AI</button>
                </div>

                <div class="chart-container" id="analysisResults" style="display: none;">
                    <div class="chart-header">
                        <div class="chart-title">Analysis Results</div>
                    </div>
                    <div id="analysisContent" style="line-height: 1.8; color: #cbd5e1;"></div>
                </div>
            </div>

            <div id="profiles" class="tab-content">
                <div class="controls-panel">
                    <h3 style="margin-bottom: 1rem;">Create Smell Profile</h3>
                    <div class="controls-grid">
                        <div class="control-group">
                            <label class="control-label">Profile Name</label>
                            <input type="text" id="profileName" class="control-input" placeholder="e.g., Fresh Coffee">
                        </div>
                        <div class="control-group">
                            <label class="control-label">Category</label>
                            <select id="profileCategory" class="control-input">
                                <option value="food">Food & Beverages</option>
                                <option value="chemical">Chemical</option>
                                <option value="nature">Nature</option>
                                <option value="industrial">Industrial</option>
                                <option value="other">Other</option>
                            </select>
                        </div>
                        <div class="control-group">
                            <label class="control-label">Description</label>
                            <input type="text" id="profileDesc" class="control-input" placeholder="Brief description">
                        </div>
                    </div>
                    <button class="btn" onclick="createProfile()" style="margin-top: 1rem;">üíæ Create Profile</button>
                </div>

                <div class="chart-container">
                    <div class="chart-header">
                        <div class="chart-title">Saved Smell Profiles</div>
                    </div>
                    <div id="profilesList" style="display: grid; gap: 1rem;">
                        <div style="text-align: center; color: #94a3b8; padding: 2rem;">
                            No profiles yet. Create your first smell profile above!
                        </div>
                    </div>
                </div>
            </div>

            <div id="settings" class="tab-content">
                <div class="controls-panel">
                    <h3 style="margin-bottom: 1rem;">Device Configuration</h3>
                    <div class="controls-grid">
                        <div class="control-group">
                            <label class="control-label">Device Name</label>
                            <input type="text" id="deviceName" class="control-input" value="XBio Sentinel 001">
                        </div>
                        <div class="control-group">
                            <label class="control-label">MQTT Server</label>
                            <input type="text" id="mqttServer" class="control-input" value="mqtt.xbio.local">
                        </div>
                        <div class="control-group">
                            <label class="control-label">MQTT Port</label>
                            <input type="number" id="mqttPort" class="control-input" value="1883">
                        </div>
                        <div class="control-group">
                            <label class="control-label">WebSocket Server</label>
                            <input type="text" id="wsServer" class="control-input" value="ws://localhost:5000">
                        </div>
                    </div>
                </div>

                <div class="controls-panel">
                    <h3 style="margin-bottom: 1rem;">Sensor Calibration</h3>
                    <div class="controls-grid">
                        <div class="control-group">
                            <label class="control-label">Temperature Offset (¬∞C)</label>
                            <input type="number" id="tempOffset" class="control-input" value="0.0" step="0.1">
                        </div>
                        <div class="control-group">
                            <label class="control-label">Humidity Offset (%)</label>
                            <input type="number" id="humidityOffset" class="control-input" value="0.0" step="0.1">
                        </div>
                    </div>
                    <button class="btn" onclick="saveSettings()" style="margin-top: 1rem;">üíæ Save Settings</button>
                </div>

                <div class="controls-panel">
                    <h3 style="margin-bottom: 1rem;">Alert Thresholds</h3>
                    <div class="controls-grid">
                        <div class="control-group">
                            <label class="control-label">Max Temperature (¬∞C)</label>
                            <input type="number" id="maxTemp" class="control-input" value="35" step="0.5">
                        </div>
                        <div class="control-group">
                            <label class="control-label">Min Temperature (¬∞C)</label>
                            <input type="number" id="minTemp" class="control-input" value="15" step="0.5">
                        </div>
                        <div class="control-group">
                            <label class="control-label">Max Humidity (%)</label>
                            <input type="number" id="maxHumidity" class="control-input" value="70">
                        </div>
                        <div class="control-group">
                            <label class="control-label">Min Air Quality</label>
                            <input type="number" id="minAirQuality" class="control-input" value="50">
                        </div>
                    </div>
                    <button class="btn" onclick="saveThresholds()" style="margin-top: 1rem;">üíæ Save Thresholds</button>
                </div>

                <div class="controls-panel">
                    <h3 style="margin-bottom: 1rem;">System Actions</h3>
                    <div style="display: flex; gap: 1rem; flex-wrap: wrap;">
                        <button class="btn" onclick="calibrateSensor()">üîß Calibrate Sensor</button>
                        <button class="btn btn-secondary" onclick="resetDevice()">üîÑ Reset Device</button>
                        <button class="btn btn-secondary" onclick="exportData()">üì• Export Data</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="footer">
        <p>¬© 2026 MRF103 ARC - XBio Field Controller v1.0.0</p>
        <p style="margin-top: 0.5rem; font-size: 0.75rem;">Proprietary and Confidential - All Rights Reserved</p>
    </div>

    <script>
        let sensorData = {
            temperature: 24.5,
            humidity: 45,
            pressure: 1013,
            gasResistance: 150000,
            airQuality: 92
        };

        let chartData = {
            labels: [],
            temperature: [],
            humidity: [],
            gasResistance: []
        };

        let profiles = [];
        let chartRange = '1h';

        function switchTab(tabName) {
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            
            event.target.classList.add('active');
            document.getElementById(tabName).classList.add('active');
        }

        function setChartRange(range) {
            chartRange = range;
            document.querySelectorAll('.chart-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            updateChart();
        }

        function updateSensorReadings() {
            sensorData.temperature = 24 + Math.random() * 2;
            sensorData.humidity = 43 + Math.random() * 4;
            sensorData.pressure = 1012 + Math.random() * 3;
            sensorData.gasResistance = 145000 + Math.random() * 10000;
            sensorData.airQuality = 90 + Math.random() * 10;

            document.getElementById('temperature').textContent = sensorData.temperature.toFixed(1) + '¬∞C';
            document.getElementById('humidity').textContent = sensorData.humidity.toFixed(0) + '%';
            document.getElementById('pressure').textContent = sensorData.pressure.toFixed(0) + ' hPa';
            document.getElementById('gasResistance').textContent = (sensorData.gasResistance / 1000).toFixed(0) + 'K Œ©';
            document.getElementById('airQuality').textContent = sensorData.airQuality.toFixed(0) + '%';

            const now = new Date();
            const timeLabel = now.getHours() + ':' + String(now.getMinutes()).padStart(2, '0');
            
            chartData.labels.push(timeLabel);
            chartData.temperature.push(sensorData.temperature);
            chartData.humidity.push(sensorData.humidity);
            chartData.gasResistance.push(sensorData.gasResistance / 1000);

            if (chartData.labels.length > 60) {
                chartData.labels.shift();
                chartData.temperature.shift();
                chartData.humidity.shift();
                chartData.gasResistance.shift();
            }

            updateChart();
            checkAlerts();
        }

        function checkAlerts() {
            const maxTemp = parseFloat(document.getElementById('maxTemp').value);
            const minTemp = parseFloat(document.getElementById('minTemp').value);
            const maxHum = parseFloat(document.getElementById('maxHumidity').value);
            const minAQ = parseFloat(document.getElementById('minAirQuality').value);

            const alertsContainer = document.getElementById('alertsContainer');
            let alerts = [];

            if (sensorData.temperature > maxTemp) {
                alerts.push({
                    icon: 'üå°Ô∏è',
                    message: 'High Temperature Alert',
                    value: `Temperature exceeded ${maxTemp}¬∞C (Current: ${sensorData.temperature.toFixed(1)}¬∞C)`
                });
            }

            if (sensorData.temperature < minTemp) {
                alerts.push({
                    icon: '‚ùÑÔ∏è',
                    message: 'Low Temperature Alert',
                    value: `Temperature below ${minTemp}¬∞C (Current: ${sensorData.temperature.toFixed(1)}¬∞C)`
                });
            }

            if (sensorData.humidity > maxHum) {
                alerts.push({
                    icon: 'üíß',
                    message: 'High Humidity Alert',
                    value: `Humidity exceeded ${maxHum}% (Current: ${sensorData.humidity.toFixed(0)}%)`
                });
            }

            if (sensorData.airQuality < minAQ) {
                alerts.push({
                    icon: '‚ö†Ô∏è',
                    message: 'Poor Air Quality',
                    value: `Air quality below ${minAQ}% (Current: ${sensorData.airQuality.toFixed(0)}%)`
                });
            }

            if (alerts.length === 0) {
                alertsContainer.innerHTML = '<div style="text-align: center; color: #94a3b8; padding: 2rem;">No active alerts</div>';
            } else {
                alertsContainer.innerHTML = alerts.map(alert => `
                    <div class="alert-item">
                        <div class="alert-icon">${alert.icon}</div>
                        <div class="alert-content">
                            <div class="alert-message">${alert.message}</div>
                            <div class="alert-time">${alert.value}</div>
                        </div>
                    </div>
                `).join('');
            }
        }

        function updateChart() {
            const canvas = document.getElementById('sensorChart');
            const ctx = canvas.getContext('2d');
            
            canvas.width = canvas.offsetWidth;
            canvas.height = 300;

            ctx.clearRect(0, 0, canvas.width, canvas.height);

            const padding = 40;
            const chartWidth = canvas.width - padding * 2;
            const chartHeight = canvas.height - padding * 2;

            ctx.strokeStyle = 'rgba(148, 163, 184, 0.2)';
            ctx.lineWidth = 1;

            for (let i = 0; i <= 5; i++) {
                const y = padding + (chartHeight / 5) * i;
                ctx.beginPath();
                ctx.moveTo(padding, y);
                ctx.lineTo(canvas.width - padding, y);
                ctx.stroke();
            }

            if (chartData.labels.length > 0) {
                drawLine(ctx, chartData.temperature, '#ef4444', padding, chartWidth, chartHeight);
                drawLine(ctx, chartData.humidity, '#3b82f6', padding, chartWidth, chartHeight);
            }

            ctx.fillStyle = '#94a3b8';
            ctx.font = '12px sans-serif';
            ctx.fillText('Temperature', padding, padding - 10);
            ctx.fillText('Time', canvas.width / 2, canvas.height - 10);
        }

        function drawLine(ctx, data, color, padding, chartWidth, chartHeight) {
            if (data.length < 2) return;

            const max = Math.max(...data);
            const min = Math.min(...data);
            const range = max - min || 1;

            ctx.strokeStyle = color;
            ctx.lineWidth = 2;
            ctx.beginPath();

            data.forEach((value, index) => {
                const x = padding + (chartWidth / (data.length - 1)) * index;
                const y = padding + chartHeight - ((value - min) / range) * chartHeight;
                
                if (index === 0) {
                    ctx.moveTo(x, y);
                } else {
                    ctx.lineTo(x, y);
                }
            });

            ctx.stroke();
        }

        function runAnalysis() {
            const query = document.getElementById('analysisQuery').value;
            const resultsDiv = document.getElementById('analysisResults');
            const contentDiv = document.getElementById('analysisContent');

            if (!query.trim()) {
                alert('Please enter a question');
                return;
            }

            resultsDiv.style.display = 'block';
            contentDiv.innerHTML = '<p style="color: #fcd34d;">üß† Analyzing data with AI...</p>';

            setTimeout(() => {
                const analysis = `
                    <h4 style="color: #3b82f6; margin-bottom: 1rem;">Analysis Results</h4>
                    <p><strong>Question:</strong> ${query}</p>
                    <p style="margin-top: 1rem;"><strong>AI Analysis:</strong></p>
                    <p>Based on the last 100 sensor readings from device ${document.getElementById('deviceId').textContent}:</p>
                    <ul style="margin-left: 1.5rem; margin-top: 0.5rem; line-height: 2;">
                        <li><strong>Temperature:</strong> Average ${sensorData.temperature.toFixed(1)}¬∞C - Stable and within normal range</li>
                        <li><strong>Humidity:</strong> Average ${sensorData.humidity.toFixed(0)}% - Optimal indoor humidity levels</li>
                        <li><strong>Air Quality (IAQ):</strong> ${sensorData.airQuality.toFixed(0)}% - Excellent air quality detected</li>
                        <li><strong>Gas Resistance:</strong> ${(sensorData.gasResistance / 1000).toFixed(0)}K Œ© - No volatile organic compounds detected</li>
                    </ul>
                    <p style="margin-top: 1rem;"><strong>Recommendations:</strong></p>
                    <ul style="margin-left: 1.5rem; margin-top: 0.5rem; line-height: 2;">
                        <li>Continue monitoring for consistent air quality</li>
                        <li>Maintain current ventilation patterns</li>
                        <li>Consider slight humidity adjustment if comfort is affected</li>
                    </ul>
                    <p style="margin-top: 1rem; color: #94a3b8; font-size: 0.875rem;"><em>Confidence: 85% | Readings Analyzed: 100 | Model: GPT-4</em></p>
                `;
                contentDiv.innerHTML = analysis;
            }, 1500);
        }

        function createProfile() {
            const name = document.getElementById('profileName').value;
            const category = document.getElementById('profileCategory').value;
            const desc = document.getElementById('profileDesc').value;

            if (!name.trim()) {
                alert('Please enter a profile name');
                return;
            }

            const profile = {
                id: 'profile-' + Date.now(),
                name: name,
                category: category,
                description: desc,
                timestamp: new Date(),
                readings: { ...sensorData }
            };

            profiles.push(profile);
            updateProfilesList();

            document.getElementById('profileName').value = '';
            document.getElementById('profileDesc').value = '';
            
            alert('Smell profile created successfully!');
        }

        function updateProfilesList() {
            const listDiv = document.getElementById('profilesList');
            
            if (profiles.length === 0) {
                listDiv.innerHTML = '<div style="text-align: center; color: #94a3b8; padding: 2rem;">No profiles yet. Create your first smell profile above!</div>';
                return;
            }

            listDiv.innerHTML = profiles.map(profile => `
                <div style="padding: 1rem; background: rgba(15, 23, 42, 0.5); border-radius: 0.5rem; border-left: 3px solid #3b82f6;">
                    <div style="display: flex; justify-content: space-between; align-items: start;">
                        <div>
                            <h4 style="margin-bottom: 0.5rem;">${profile.name}</h4>
                            <div style="font-size: 0.875rem; color: #94a3b8; margin-bottom: 0.5rem;">
                                Category: ${profile.category} | Created: ${profile.timestamp.toLocaleString()}
                            </div>
                            <div style="font-size: 0.875rem; color: #cbd5e1;">${profile.description}</div>
                        </div>
                        <button class="btn btn-secondary" onclick="deleteProfile('${profile.id}')" style="padding: 0.5rem 1rem; font-size: 0.75rem;">Delete</button>
                    </div>
                    <div style="margin-top: 1rem; font-size: 0.75rem; color: #64748b;">
                        Temp: ${profile.readings.temperature.toFixed(1)}¬∞C | 
                        Humidity: ${profile.readings.humidity.toFixed(0)}% | 
                        Gas: ${(profile.readings.gasResistance / 1000).toFixed(0)}K Œ©
                    </div>
                </div>
            `).join('');
        }

        function deleteProfile(id) {
            if (confirm('Are you sure you want to delete this profile?')) {
                profiles = profiles.filter(p => p.id !== id);
                updateProfilesList();
            }
        }

        function saveSettings() {
            alert('Settings saved successfully!\n\nNote: In production, this would update the ESP32 configuration via BLE/WiFi.');
        }

        function saveThresholds() {
            checkAlerts();
            alert('Alert thresholds saved successfully!');
        }

        function calibrateSensor() {
            if (confirm('Start sensor calibration? This will take approximately 5 minutes.')) {
                alert('Calibration started!\n\nThe BME688 sensor is now in calibration mode. Please ensure stable environmental conditions.');
            }
        }

        function resetDevice() {
            if (confirm('Are you sure you want to reset the device? This will restart the ESP32 and clear temporary data.')) {
                alert('Device reset command sent!\n\nThe device will restart in 3 seconds.');
            }
        }

        function exportData() {
            const data = {
                deviceId: document.getElementById('deviceId').textContent,
                timestamp: new Date().toISOString(),
                currentReadings: sensorData,
                historicalData: chartData,
                profiles: profiles
            };

            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `xbio-data-${Date.now()}.json`;
            a.click();
            URL.revokeObjectURL(url);
        }

        setInterval(updateSensorReadings, 2000);
        updateSensorReadings();
        updateChart();
    </script>
</body>
</html>