/**\n * Social Media Agent\n * Generates social media content for different platforms\n */\n\nimport { generateContent, streamGenerate } from '@/api/geminiClient'\n\nconst SOCIAL_MEDIA_TEMPLATES = {\n  twitter: {\n    maxLength: 280,\n    hashtags: 5,\n    template: `أنشئ تغريدة جذابة عن الكتاب:\nالعنوان: {title}\nالملخص: {summary}\n\nالمتطلبات:\n- أقصى 280 حرف\n- 3-5 هاشتاجات\n- جذابة وملهمة\n- تشجع على المشاركة`\n  },\n  instagram: {\n    maxLength: 2200,\n    hashtags: 30,\n    template: `أنشئ منشور Instagram جذاب:\nالعنوان: {title}\nالملخص: {summary}\n\nالمتطلبات:\n- وصف جذاب (200-300 كلمة)\n- 15-30 هاشتاج\n- استخدم emojis بحكمة\n- اجعله قابلاً للمشاركة\n- أضف call-to-action`\n  },\n  facebook: {\n    maxLength: 5000,\n    hashtags: 10,\n    template: `أنشئ منشور Facebook احترافي:\nالعنوان: {title}\nالملخص: {summary}\n\nالمتطلبات:\n- وصف شامل (300-500 كلمة)\n- قصة جذابة\n- 5-10 هاشتاجات\n- اجعله يشجع على التفاعل\n- أضف أسئلة للمتابعين`\n  },\n  linkedin: {\n    maxLength: 3000,\n    hashtags: 5,\n    template: `أنشئ منشور LinkedIn احترافي:\nالعنوان: {title}\nالملخص: {summary}\n\nالمتطلبات:\n- محتوى احترافي وملهم\n- 300-400 كلمة\n- ركز على القيمة والفائدة\n- 3-5 هاشتاجات\n- اجعله قابلاً للمشاركة`\n  },\n  tiktok: {\n    maxLength: 2200,\n    template: `أنشئ وصف TikTok جذاب:\nالعنوان: {title}\nالملخص: {summary}\n\nالمتطلبات:\n- وصف قصير وجذاب (50-100 كلمة)\n- استخدم trending sounds/hashtags\n- اجعله يشجع على المشاركة\n- أضف call-to-action\n- استخدم emojis`\n  }\n}\n\n/**\n * Generate social media content for all platforms\n */\nexport async function generateSocialMediaContent(manuscript, onProgress) {\n  try {\n    const content = {}\n    const platforms = Object.keys(SOCIAL_MEDIA_TEMPLATES)\n\n    for (const platform of platforms) {\n      const template = SOCIAL_MEDIA_TEMPLATES[platform]\n      const prompt = template.template\n        .replace('{title}', manuscript.title || '')\n        .replace('{summary}', manuscript.description || manuscript.content?.substring(0, 500) || '')\n\n      let platformContent = ''\n      await streamGenerate(prompt, (chunk) => {\n        platformContent += chunk\n        if (onProgress) onProgress({ platform, content: platformContent })\n      })\n\n      content[platform] = platformContent\n    }\n\n    return {\n      success: true,\n      data: content\n    }\n  } catch (error) {\n    console.error('Social media agent error:', error)\n    throw new Error(`فشل توليد محتوى وسائل التواصل: ${error.message}`)\n  }\n}\n\n/**\n * Generate content for specific platform\n */\nexport async function generatePlatformContent(manuscript, platform) {\n  try {\n    const template = SOCIAL_MEDIA_TEMPLATES[platform.toLowerCase()]\n    if (!template) {\n      throw new Error(`منصة غير مدعومة: ${platform}`)\n    }\n\n    const prompt = template.template\n      .replace('{title}', manuscript.title || '')\n      .replace('{summary}', manuscript.description || manuscript.content?.substring(0, 500) || '')\n\n    const content = await generateContent(prompt)\n    return {\n      platform,\n      content,\n      maxLength: template.maxLength,\n      currentLength: content.length,\n      isValid: content.length <= template.maxLength\n    }\n  } catch (error) {\n    console.error('Platform content generation error:', error)\n    throw error\n  }\n}\n\n/**\n * Generate hashtag suggestions\n */\nexport async function generateHashtags(manuscript, count = 20) {\n  try {\n    const prompt = `أنشئ ${count} هاشتاج ذو صلة بالكتاب:\n\nالعنوان: ${manuscript.title}\nالنوع: ${manuscript.genre}\nالملخص: ${manuscript.description || manuscript.content?.substring(0, 300) || ''}\n\nالمتطلبات:\n- هاشتاجات شهيرة وذات صلة\n- مزيج من الهاشتاجات العامة والمتخصصة\n- هاشتاجات باللغة العربية والإنجليزية\n- مرتبة حسب الشهرة\n\nأعد الهاشتاجات فقط، واحد في كل سطر، بدون شرح.`\n\n    const response = await generateContent(prompt)\n    const hashtags = response\n      .split('\\n')\n      .map(tag => tag.trim())\n      .filter(tag => tag.startsWith('#') || tag.length > 0)\n      .map(tag => tag.startsWith('#') ? tag : `#${tag}`)\n      .slice(0, count)\n\n    return hashtags\n  } catch (error) {\n    console.error('Hashtag generation error:', error)\n    throw error\n  }\n}\n\n/**\n * Generate posting schedule\n */\nexport async function generatePostingSchedule(manuscript) {\n  try {\n    const prompt = `أنشئ جدول نشر محتوى لكتاب:\n\nالعنوان: ${manuscript.title}\nالنوع: ${manuscript.genre}\n\nأنشئ جدول نشر مثالي يتضمن:\n1. أفضل أوقات النشر لكل منصة\n2. تكرار النشر الموصى به\n3. أنواع المحتوى لكل يوم\n4. استراتيجية المشاركة\n5. نصائح للتفاعل\n\nصيغة الإجابة:\nالمنصة | أفضل وقت | التكرار | نوع المحتوى`\n\n    const schedule = await generateContent(prompt)\n    return parseSchedule(schedule)\n  } catch (error) {\n    console.error('Schedule generation error:', error)\n    throw error\n  }\n}\n\n/**\n * Parse posting schedule\n */\nfunction parseSchedule(text) {\n  const lines = text.split('\\n').filter(line => line.trim())\n  const schedule = []\n\n  lines.forEach(line => {\n    const parts = line.split('|').map(p => p.trim())\n    if (parts.length >= 4) {\n      schedule.push({\n        platform: parts[0],\n        bestTime: parts[1],\n        frequency: parts[2],\n        contentType: parts[3]\n      })\n    }\n  })\n\n  return schedule\n}\n\n/**\n * Generate engagement strategies\n */\nexport async function generateEngagementStrategies(manuscript) {\n  try {\n    const prompt = `اقترح استراتيجيات تفاعل لكتاب:\n\nالعنوان: ${manuscript.title}\nالنوع: ${manuscript.genre}\nالجمهور المستهدف: ${manuscript.target_audience || 'عام'}\n\nاقترح:\n1. 5 طرق لزيادة التفاعل\n2. 5 أسئلة يمكن طرحها على المتابعين\n3. 5 تحديات أو مسابقات\n4. 5 محتويات خلف الكواليس\n5. 5 طرق للتعاون مع المؤثرين\n\nاجعل الاقتراحات عملية وقابلة للتطبيق.`\n\n    const strategies = await generateContent(prompt)\n    return parseStrategies(strategies)\n  } catch (error) {\n    console.error('Engagement strategies error:', error)\n    throw error\n  }\n}\n\n/**\n * Parse engagement strategies\n */\nfunction parseStrategies(text) {\n  const sections = text.split(/\\d\\.\\s+/)\n  return {\n    engagement: extractItems(sections[1] || ''),\n    questions: extractItems(sections[2] || ''),\n    challenges: extractItems(sections[3] || ''),\n    behindScenes: extractItems(sections[4] || ''),\n    influencerCollabs: extractItems(sections[5] || '')\n  }\n}\n\n/**\n * Extract items from text\n */\nfunction extractItems(text) {\n  return text\n    .split('\\n')\n    .map(line => line.replace(/^[-•*]\\s*/, '').trim())\n    .filter(line => line.length > 0)\n    .slice(0, 5)\n}\n\n/**\n * Generate content calendar\n */\nexport async function generateContentCalendar(manuscript, weeks = 4) {\n  try {\n    const prompt = `أنشئ تقويم محتوى لمدة ${weeks} أسابيع:\n\nالكتاب: ${manuscript.title}\nالنوع: ${manuscript.genre}\n\nأنشئ جدول يومي يتضمن:\n- اليوم والتاريخ\n- المنصة\n- نوع المحتوى\n- الموضوع/الرسالة\n- الهاشتاجات\n\nصيغة الإجابة:\nالأسبوع | اليوم | المنصة | النوع | الموضوع | الهاشتاجات`\n\n    const calendar = await generateContent(prompt)\n    return parseCalendar(calendar)\n  } catch (error) {\n    console.error('Content calendar error:', error)\n    throw error\n  }\n}\n\n/**\n * Parse content calendar\n */\nfunction parseCalendar(text) {\n  const lines = text.split('\\n').filter(line => line.trim())\n  const calendar = []\n\n  lines.forEach(line => {\n    const parts = line.split('|').map(p => p.trim())\n    if (parts.length >= 6) {\n      calendar.push({\n        week: parts[0],\n        day: parts[1],\n        platform: parts[2],\n        type: parts[3],\n        topic: parts[4],\n        hashtags: parts[5]\n      })\n    }\n  })\n\n  return calendar\n}\n
