{
  "name": "NEXUS Auto-Nurturing Sequence",
  "nodes": [
    {
      "parameters": {
        "rule": {
          "interval": [{"field": "hours", "hoursInterval": 24}]
        }
      },
      "name": "Daily Trigger",
      "type": "n8n-nodes-base.scheduleTrigger",
      "typeVersion": 1,
      "position": [250, 300]
    },
    {
      "parameters": {
        "url": "http://localhost:8001/api/v1/leads",
        "options": {}
      },
      "name": "Fetch Leads",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 3,
      "position": [450, 300]
    },
    {
      "parameters": {
        "jsCode": "// Filter leads that need nurturing\nconst leads = $input.all();\nconst now = new Date();\nconst results = [];\n\nfor (const item of leads) {\n  const lead = item.json;\n  if (!lead.email || !lead.timestamp) continue;\n  \n  const leadDate = new Date(lead.timestamp);\n  const daysSince = Math.floor((now - leadDate) / (1000 * 60 * 60 * 24));\n  \n  // Determine nurturing stage\n  let stage = '';\n  let template = '';\n  \n  if (daysSince === 0) {\n    stage = 'welcome';\n    template = 'welcome_email';\n  } else if (daysSince === 1) {\n    stage = 'day1_features';\n    template = 'features_highlight';\n  } else if (daysSince === 3) {\n    stage = 'day3_social_proof';\n    template = 'testimonials';\n  } else if (daysSince === 7) {\n    stage = 'day7_trial_ending';\n    template = 'trial_urgency';\n  } else if (daysSince === 14) {\n    stage = 'day14_final_offer';\n    template = 'final_discount';\n  } else {\n    continue; // Skip non-trigger days\n  }\n  \n  results.push({\n    json: {\n      ...lead,\n      daysSince,\n      stage,\n      template,\n      product: lead.product || 'general'\n    }\n  });\n}\n\nreturn results.length > 0 ? results : [{json: {skip: true}}];"
      },
      "name": "Nurture Logic",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [650, 300]
    },
    {
      "parameters": {
        "conditions": {
          "boolean": [
            {"value1": "={{ $json.skip }}", "value2": true}
          ]
        }
      },
      "name": "Has Leads?",
      "type": "n8n-nodes-base.if",
      "typeVersion": 1,
      "position": [850, 300]
    },
    {
      "parameters": {
        "jsCode": "// Generate email content based on stage and product\nconst lead = $input.item.json;\n\nconst templates = {\n  welcome_email: {\n    subject: `ğŸ‰ Ù…Ø±Ø­Ø¨Ø§Ù‹ ÙÙŠ NEXUS PRIME - ${lead.product}`,\n    body: `<html dir='rtl'><body style='font-family:Cairo,sans-serif;background:#0a0a0a;color:#fff;padding:40px'>\n      <div style='max-width:600px;margin:0 auto;background:#111;border-radius:16px;padding:40px;border:1px solid #333'>\n        <h1 style='color:#6366f1'>ğŸš€ Ù…Ø±Ø­Ø¨Ø§Ù‹ ÙÙŠ NEXUS PRIME</h1>\n        <p>Ø´ÙƒØ±Ø§Ù‹ Ù„Ø§Ù‡ØªÙ…Ø§Ù…Ùƒ Ø¨Ù€ <strong style='color:#8b5cf6'>${lead.product}</strong></p>\n        <p>ÙØªØ±ØªÙƒ Ø§Ù„ØªØ¬Ø±ÙŠØ¨ÙŠØ© (14 ÙŠÙˆÙ…) Ø¨Ø¯Ø£Øª Ø§Ù„Ø¢Ù†!</p>\n        <h3>ğŸ¯ Ø®Ø·ÙˆØ§ØªÙƒ Ø§Ù„ØªØ§Ù„ÙŠØ©:</h3>\n        <ol>\n          <li>ğŸ” ÙØ¹Ù‘Ù„ Ø­Ø³Ø§Ø¨Ùƒ</li>\n          <li>ğŸ“– Ø§Ø³ØªÙƒØ´Ù Ø§Ù„Ø£Ø¯Ù„Ø© Ø§Ù„ØªØ¹Ù„ÙŠÙ…ÙŠØ©</li>\n          <li>ğŸ’¡ Ø¬Ø±Ø¨ Ø£ÙˆÙ„ Ù…Ø´Ø±ÙˆØ¹</li>\n        </ol>\n        <a href='https://mrf103.com' style='display:inline-block;background:#6366f1;color:white;padding:15px 40px;border-radius:12px;text-decoration:none;margin-top:20px'>Ø§Ø¨Ø¯Ø£ Ø§Ù„Ø¢Ù† â†’</a>\n      </div></body></html>`\n  },\n  features_highlight: {\n    subject: `ğŸ’¡ Ø§ÙƒØªØ´Ù Ù‚ÙˆØ© ${lead.product} - NEXUS`,\n    body: `<html dir='rtl'><body style='font-family:Cairo,sans-serif;background:#0a0a0a;color:#fff;padding:40px'>\n      <div style='max-width:600px;margin:0 auto;background:#111;border-radius:16px;padding:40px;border:1px solid #333'>\n        <h1 style='color:#6366f1'>ğŸ’¡ Ù‡Ù„ Ø¬Ø±Ø¨Øª Ù‡Ø°Ù‡ Ø§Ù„Ù…ÙŠØ²Ø§ØªØŸ</h1>\n        <p>Ù…Ø³ØªØ®Ø¯Ù…Ùˆ <strong>${lead.product}</strong> ÙŠØ­Ù‚Ù‚ÙˆÙ† Ù†ØªØ§Ø¦Ø¬ Ù…Ø°Ù‡Ù„Ø©:</p>\n        <ul style='line-height:2'>\n          <li>âš¡ Ø£ØªÙ…ØªØ© 80% Ù…Ù† Ø§Ù„Ù…Ù‡Ø§Ù… Ø§Ù„ÙŠØ¯ÙˆÙŠØ©</li>\n          <li>ğŸ“Š ØªØ­Ù„ÙŠÙ„Ø§Øª Ø°ÙƒÙŠØ© Ø¨Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ</li>\n          <li>ğŸ”„ ØªÙƒØ§Ù…Ù„ Ø³Ù„Ø³ Ù…Ø¹ Ø£Ø¯ÙˆØ§ØªÙƒ Ø§Ù„Ø­Ø§Ù„ÙŠØ©</li>\n        </ul>\n        <a href='https://mrf103.com' style='display:inline-block;background:#6366f1;color:white;padding:15px 40px;border-radius:12px;text-decoration:none;margin-top:20px'>Ø§Ø³ØªÙƒØ´Ù Ø§Ù„Ù…ÙŠØ²Ø§Øª â†’</a>\n      </div></body></html>`\n  },\n  testimonials: {\n    subject: `â­ Ù…Ø§Ø°Ø§ ÙŠÙ‚ÙˆÙ„ Ù…Ø³ØªØ®Ø¯Ù…Ùˆ NEXUS PRIME`,\n    body: `<html dir='rtl'><body style='font-family:Cairo,sans-serif;background:#0a0a0a;color:#fff;padding:40px'>\n      <div style='max-width:600px;margin:0 auto;background:#111;border-radius:16px;padding:40px;border:1px solid #333'>\n        <h1 style='color:#6366f1'>â­ Ù‚ØµØµ Ù†Ø¬Ø§Ø­ Ø­Ù‚ÙŠÙ‚ÙŠØ©</h1>\n        <div style='background:#1a1a2e;padding:20px;border-radius:12px;margin:15px 0;border-right:4px solid #6366f1'>\n          <p>\"ØºÙŠÙ‘Ø± NEXUS Ø·Ø±ÙŠÙ‚Ø© Ø¹Ù…Ù„ÙŠ Ø¨Ø§Ù„ÙƒØ§Ù…Ù„. ÙˆÙÙ‘Ø±Øª 20 Ø³Ø§Ø¹Ø© Ø£Ø³Ø¨ÙˆØ¹ÙŠØ§Ù‹\"</p>\n          <small style='color:#888'>- Ù…Ø¤Ø³Ø³ Ø´Ø±ÙƒØ© ØªÙ‚Ù†ÙŠØ©</small>\n        </div>\n        <p>Ù„Ø¯ÙŠÙƒ <strong>11 ÙŠÙˆÙ…</strong> Ù…ØªØ¨Ù‚ÙŠØ© ÙÙŠ ÙØªØ±ØªÙƒ Ø§Ù„ØªØ¬Ø±ÙŠØ¨ÙŠØ©</p>\n        <a href='https://mrf103.com' style='display:inline-block;background:#6366f1;color:white;padding:15px 40px;border-radius:12px;text-decoration:none;margin-top:20px'>ÙˆØ§ØµÙ„ Ø§Ù„Ø±Ø­Ù„Ø© â†’</a>\n      </div></body></html>`\n  },\n  trial_urgency: {\n    subject: `â° 7 Ø£ÙŠØ§Ù… Ù…ØªØ¨Ù‚ÙŠØ© - Ù„Ø§ ØªÙÙˆØª Ø§Ù„Ø¹Ø±Ø¶`,\n    body: `<html dir='rtl'><body style='font-family:Cairo,sans-serif;background:#0a0a0a;color:#fff;padding:40px'>\n      <div style='max-width:600px;margin:0 auto;background:#111;border-radius:16px;padding:40px;border:1px solid #333'>\n        <h1 style='color:#f59e0b'>â° ÙØªØ±ØªÙƒ Ø§Ù„ØªØ¬Ø±ÙŠØ¨ÙŠØ© ØªÙ†ØªÙ‡ÙŠ Ù‚Ø±ÙŠØ¨Ø§Ù‹!</h1>\n        <p>ØªØ¨Ù‚Ù‰ Ù„Ùƒ <strong style='color:#ef4444'>7 Ø£ÙŠØ§Ù…</strong> ÙÙ‚Ø·</p>\n        <div style='background:linear-gradient(135deg,#6366f1,#8b5cf6);padding:25px;border-radius:12px;margin:20px 0;text-align:center'>\n          <h2 style='margin:0'>Ø®ØµÙ… 20% Ù„Ù„Ø§Ø´ØªØ±Ø§Ùƒ Ø§Ù„Ù…Ø¨ÙƒØ±</h2>\n          <p style='margin:5px 0'>Ø§Ø³ØªØ®Ø¯Ù… Ø§Ù„ÙƒÙˆØ¯: <strong>EARLY20</strong></p>\n        </div>\n        <a href='https://mrf103.com/#pricing' style='display:inline-block;background:#f59e0b;color:black;padding:15px 40px;border-radius:12px;text-decoration:none;margin-top:20px;font-weight:bold'>Ø§Ø´ØªØ±Ùƒ Ø§Ù„Ø¢Ù† Ø¨Ø®ØµÙ… 20% â†’</a>\n      </div></body></html>`\n  },\n  final_discount: {\n    subject: `ğŸ”¥ Ø§Ù„Ø¹Ø±Ø¶ Ø§Ù„Ø£Ø®ÙŠØ± - Ø®ØµÙ… 30% ÙŠÙ†ØªÙ‡ÙŠ Ø§Ù„ÙŠÙˆÙ…`,\n    body: `<html dir='rtl'><body style='font-family:Cairo,sans-serif;background:#0a0a0a;color:#fff;padding:40px'>\n      <div style='max-width:600px;margin:0 auto;background:#111;border-radius:16px;padding:40px;border:1px solid #ef4444'>\n        <h1 style='color:#ef4444'>ğŸ”¥ ÙØ±ØµØªÙƒ Ø§Ù„Ø£Ø®ÙŠØ±Ø©!</h1>\n        <p>ÙØªØ±ØªÙƒ Ø§Ù„ØªØ¬Ø±ÙŠØ¨ÙŠØ© Ù„Ù€ <strong>${lead.product}</strong> ØªÙ†ØªÙ‡ÙŠ <strong>Ø§Ù„ÙŠÙˆÙ…</strong></p>\n        <div style='background:linear-gradient(135deg,#ef4444,#dc2626);padding:30px;border-radius:12px;margin:20px 0;text-align:center'>\n          <h2 style='margin:0;font-size:28px'>Ø®ØµÙ… 30%</h2>\n          <p style='margin:5px 0'>Ø§Ù„ÙƒÙˆØ¯: <strong>FINAL30</strong></p>\n          <small>ØµØ§Ù„Ø­ Ù„Ù€ 24 Ø³Ø§Ø¹Ø© ÙÙ‚Ø·</small>\n        </div>\n        <a href='https://mrf103.com/#pricing' style='display:inline-block;background:#ef4444;color:white;padding:15px 40px;border-radius:12px;text-decoration:none;margin-top:20px;font-weight:bold'>Ø§Ø´ØªØ±Ùƒ Ø§Ù„Ø¢Ù† Ù‚Ø¨Ù„ ÙÙˆØ§Øª Ø§Ù„Ø£ÙˆØ§Ù† â†’</a>\n      </div></body></html>`\n  }\n};\n\nconst emailData = templates[lead.template] || templates.welcome_email;\n\nreturn [{\n  json: {\n    to: lead.email,\n    subject: emailData.subject,\n    html: emailData.body,\n    stage: lead.stage,\n    product: lead.product\n  }\n}];"
      },
      "name": "Generate Email",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [1050, 200]
    },
    {
      "parameters": {
        "url": "http://localhost:8001/api/v1/nurture-log",
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {"name": "email", "value": "={{ $json.to }}"},
            {"name": "stage", "value": "={{ $json.stage }}"},
            {"name": "product", "value": "={{ $json.product }}"},
            {"name": "sent_at", "value": "={{ new Date().toISOString() }}"}
          ]
        },
        "options": {}
      },
      "name": "Log Nurture",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 3,
      "position": [1250, 200]
    },
    {
      "parameters": {},
      "name": "No Leads Today",
      "type": "n8n-nodes-base.noOp",
      "typeVersion": 1,
      "position": [1050, 400]
    }
  ],
  "connections": {
    "Daily Trigger": {
      "main": [
        [{"node": "Fetch Leads", "type": "main", "index": 0}]
      ]
    },
    "Fetch Leads": {
      "main": [
        [{"node": "Nurture Logic", "type": "main", "index": 0}]
      ]
    },
    "Nurture Logic": {
      "main": [
        [{"node": "Has Leads?", "type": "main", "index": 0}]
      ]
    },
    "Has Leads?": {
      "main": [
        [{"node": "No Leads Today", "type": "main", "index": 0}],
        [{"node": "Generate Email", "type": "main", "index": 0}]
      ]
    },
    "Generate Email": {
      "main": [
        [{"node": "Log Nurture", "type": "main", "index": 0}]
      ]
    }
  },
  "settings": {
    "executionOrder": "v1"
  },
  "tags": [{"name": "marketing"}, {"name": "nurturing"}, {"name": "email"}]
}
